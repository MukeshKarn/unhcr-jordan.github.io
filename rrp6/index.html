<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<meta content='width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0' name='viewport'>
<meta name="author" content="Edouard Legoupil">
<meta property="og:title" content="2014 Refugee Response in Jordan"/>
<meta property="og:type" content="article"/>
<meta property="og:url" content="http://data.unhcr.org/jordan/rrp6"/>
<meta property="og:image" content="http://data.unhcr.org/jordan/rrp6/thumbnail.jpg"/>
<meta property="og:site_name" content="2014 Refugee Response in Jordan"/>
<meta property="og:description" content="2014 Refugee Response in Jordan"/>
    <title>2014 Refugee Response Plan in Jordan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/dc.css"/>
    <link rel="stylesheet" type="text/css" href="css/3w-dashboard.css"/>
    <!-- Add IntroJs styles and JS -->
    <link rel="stylesheet" type="text/css" href="css/introjs.min.css" >
    <script type="text/javascript" src="js/intro.min.js"></script>
    <script src="js/jquery-1.6.2.min.js"></script>
    <!-- map the data to the GeoJSON object -->
    <script src="js/data-jo.js"></script>
    <link href="http://www.unhcr.org/favicon.ico" rel="icon" type="image/x-icon">
  </head>

  <body>
    <div class ="col-sm-4 col-md-offset4" id="loading">
        <h1>Patience: Loading the data... (~a few MB)</h1><small>This webpage does not work on IE8 or older... Upgrade your browser if needed</a></a></small>
    </div>
    <div class="container" id="dashboard">
        <h1><strong>2014 Refugee Response Plan in Jordan</strong></h1>
        <div class="col-xs-12">Explore <a href="http://www.unhcr.org/52b170e49.html" target="_blank" >2014 Interagency Response</a> financial requirement (in USD)
        for Refugee Crisis in Jordan (<i><small><a href="https://www.syrianrefugeeresponse.org" target="_blank" >source</a></small></i>). Click on any of those graphs below to filter and slice the data. More info on Jordan <a href="http://data.unhcr.org/syrianrefugees/country.php?id=107" target="_blank" >here</a>.</div>

            <div class="socialmedia" data-step="6" data-intro="Feel Free to share if you like it!" data-position='left'>
                <table>
                  <tr>
                    <td valign="middle" ><a href="http://www.facebook.com/sharer.php?u=http://data.unhcr.org/jordan/rrp6" target="_blank"><img src="images/Facebook.png" style="height: 25px; width: 25px"/></a></td>
                    <td valign="middle"><a href="http://pinterest.com/pin/create/button/?url=http%3A%2F%2Fdata.unhcr.org/jordan/rrp6&amp;media=http%3A%2F%2Fdata.unhcr.org/jordan/rrp6/thumbnail.png" target="_blank" data-pin-do="buttonBookmark" ><img src="images/Pinterest.png" style="height: 28px; width: 28px"/></a></td>
                    <td valign="middle"><a href="https://twitter.com/intent/tweet?url=http://data.unhcr.org/jordan/rrp6&text=%23Jordan%20@Refugees" target="_blank"><img src="images/Twitter.png" style="height: 25px; width: 25px"/></a></td>
                    <td valign="middle"><a href="https://plus.google.com/share?&hl=en&url=http://data.unhcr.org/jordan/rrp6" target="_blank"><img src="images/Google.png" style="height: 25px; width: 25px"/></a></td>
                </tr>
                </table>
           </div>
        <div class="row">
            <div class="col-md-8"data-step="5" data-intro="Here's the number of activities you filtered. Use the reset button to delete all your filters" data-position='right'>
                <div id="count-info" ><strong><span class="filter-count "></span></strong> selected out of <span class="total-count "></span> records</div>
                <a class="reset btn btn-primary btn-sm" id="reset" href="javascript:dc.filterAll();dc.redrawAll();">Reset All</a>
            </div>
            <div class="col-md-4">
                <a class="btn btn btn-success" href="javascript:void(0);" onclick="javascript:introJs().start();">Tutorial</a>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
              <div class="row">
                <div id="sector" class="col-xs-6" data-step="1" data-intro="Click on this pie chart to filter by sector." data-position='right'>
                  <h4>Humanitarian Sectors</h4>
                </div>
              </div>
              <div class="row">
                <div id="status" class="col-xs-6" data-step="2" data-intro="Click on this row chart to filter by prioritisation level." data-position='right'>
                  <h4>Prioritisation Level</h4>
                </div>
              </div>
            </div>
            <div id="orgs" class="col-md-4" data-step="3" data-intro="Click on this row chart to filter by partner." data-position='right'>
                  <h4>Highest Appealing Partners</h4>
                  <div class="col-xs-12">By financial requirement</div>
            </div>
            <div id="map" class="col-md-4" >
              <h4>Geographic filter:<a href="javascript:governoratesMapShow();">Governorates</a> -or- Regions</h4>
              <p><small>Some activities are country-wide or for camps only.</small></p>
            </div>
            <div id="map2" class="col-md-4" data-step="4" data-intro="Click anywhere on the map to filter the results. The camp icon filters activities for camp only and the small jordan map filters country-wide activities" data-position='left'>
              <h4>Geographic filter: Governorates -or- <a href="javascript:regionsMapShow();">Regions</a></h4>
              <p><small>Some activities are country-wide or for camps only.</small></p>
            </div>
        </div>
    </div>
    <small></samll><a href="https://github.com/edouard-legoupil/3W-Dashboard/" target="_blank" >Credit</a></small>

    <script type="text/javascript" src="js/d3.js"></script>
    <script type="text/javascript" src="js/crossfilter.js"></script>
    <script type="text/javascript" src="js/dc.js"></script>
    <script type="text/javascript" src="js/d3.tip.min.js"></script>

    <script>
        function regionsMapShow(){
            $('#map2').hide();
            $('#map').show();
            map2_chart.filterAll();
            dc.redrawAll();
        }

        function governoratesMapShow(){
            $('#map').hide();
            $('#map2').show();
        }
        $('#dashboard').hide();
        $('#map').hide();
        var sector_chart = dc.pieChart("#sector");
        var status_chart = dc.rowChart("#status");
        var map_chart = dc.geoChoroplethChart("#map");
        var org_chart = dc.rowChart("#orgs");
        var map2_chart = dc.geoChoroplethChart("#map2");

        d3.csv("data/3W_Data-jo1.csv", function(csv_data){

            var numberFormat = d3.format(",f");

            var cf = crossfilter(csv_data);

            cf.organisation = cf.dimension(function(d) { return d.Organisation; });
            cf.sector = cf.dimension(function(d) { return d.SectorJo; });
            cf.status = cf.dimension(function(d) { return d.Status; });
            cf.rcode = cf.dimension(function(d) { return d.RegionCODE; });
            cf.gcode = cf.dimension(function(d) { return d.GovCODE; });
            cf.total = cf.dimension(function(d) { return d.Total; });

            var organisation = cf.organisation.group();
            var sector = cf.sector.group();
            var status = cf.status.group();
            var rcode = cf.rcode.group();
            var gcode = cf.gcode.group();
            var all = cf.groupAll();

            var sectorByTotal = cf.sector.group().reduceSum(function (d) { return d.Total; });
            var organisationByTotal = cf.organisation.group().reduceSum(function (d) { return d.Total; });
            var statusByTotal = cf.status.group().reduceSum(function (d) { return d.Total; });

            // Implement bookmarking chart filters status --> Thanks to https://github.com/franckalbinet
            // Serializing filters values in URL
            function getFiltersValues() {
                var filters = [
                    { name: 'sector', value: sector_chart.filters()},
                    { name: 'status', value: status_chart.filters()},
                    { name: 'org', value: org_chart.filters()},
                    { name: 'map', value: map2_chart.filters()}];

                var recursiveEncoded = $.param( filters );
                location.hash = recursiveEncoded;
            }
            // Init chart filters
            function initFilters() {
                // Get hash values
                var parseHash = /^#sector=([A-Za-z0-9,_\-\/\s]*)&status=([A-Za-z0-9,_\-\/\s]*)&org=([A-Za-z0-9,_\-\/\s]*)&map=([A-Za-z0-9,_\-\/\s]*)$/;
                var parsed = parseHash.exec(decodeURIComponent(location.hash));
                function filter(chart, rank) {  // for instance chart = sector_chart and rank in URL hash = 1
                    // sector chart
                    if (parsed[rank] == "") {
                        chart.filter(null);
                    }
                    else {
                        var filterValues = parsed[rank].split(",");
                        for (var i = 0; i < filterValues.length; i++ ) {
                            chart.filter(filterValues[i]);
                        }
                    }
                }
                if (parsed) {
                    filter(sector_chart, 1);
                    filter(status_chart, 2);
                    filter(org_chart, 3);
                    filter(map2_chart, 4);
                }
            }

            // tooltips for row chart
            var rowTip = d3.tip()
                  .attr('class', 'd3-tip')
                  .offset([-10, 0])
                  .html(function (d) { return "<span style='color: #f0027f'>" +  d.key + "</span> : "  + numberFormat(d.value) + " USD"; });

            // tooltips for pie chart
            var pieTip = d3.tip()
                  .attr('class', 'd3-tip')
                  .offset([-10, 0])
                  .html(function (d) { return "<span style='color: #f0027f'>" +  d.data.key + "</span> : "  + numberFormat(d.value) + " USD"; });

            // tooltips for bar chart
            var barTip = d3.tip()
                  .attr('class', 'd3-tip')
                  .offset([-10, 0])
                  .html(function (d) { return "<span style='color: #f0027f'>" + d.data.key + "</span> : " + numberFormat(d.y) + " USD";});


             /* 3W data are sorted per sector and color are allocated to sectors as per standard code in rrp6 */
            sector_chart.width(280).height(280)
                .dimension(cf.sector)
                .group(sectorByTotal)
                .innerRadius(10)
                .colors(['#c00000', /* cash */
                        '#31859c', /* education */
                        '#948a54', /* food */
                        '#43b305', /* health */
                        '#026cb6', /* nfi */
                        '#1f4981', /* protection */
                        '#ffc000', /* shelter */
                        '#8064a2', /* wash */
                        ])
                .colorDomain([0,7])
                .renderLabel(true)
                .colorAccessor(function(d, i){return i%8;})
                .on("filtered", getFiltersValues);



            status_chart.width(280).height(180)
                .dimension(cf.status)
                .group(statusByTotal)
                .elasticX(true)
                .on("filtered", getFiltersValues)
                .xAxis().ticks(4).tickFormat(d3.format("s"));


            org_chart.width(450).height(500)
                .dimension(cf.organisation)
                .group(organisationByTotal)
                .elasticX(true)
                .on("filtered", getFiltersValues)
                .data(function(group) {
                    return group.top(20);
                })
                .colors(['#3182bd'])
                .colorDomain([0,0])
                .colorAccessor(function(d, i){return 1;})
                .xAxis().ticks(4).tickFormat(d3.format("s"));

            dc.dataCount("#count-info")
            .dimension(cf)
            .group(all);

             /* Region map with ID rid */
            d3.json("data/region.geojson", function (regionsJSON) {

                map_chart.width(400).height(300)
                    .dimension(cf.rcode)
                    .group(rcode)
                    .colors(['#AAAAAA', '#CB181D'])
                    .colorDomain([0, 1])
                    .on("filtered", getFiltersValues)
                    .colorAccessor(function (d) {
                        if(d>0){
                            return 1;
                        } else {
                            return 0;
                        }
                    })
                    .overlayGeoJson(regionsJSON.features, "Region", function (d) {
                        return d.properties.rid;
                    })
                    .projection(d3.geo.mercator().center([42,29.9]).scale(3500)) /* Center on Jordan */
                    .title(function (d) {
                        return "Geo-Filter: " + rcode2reg[d.key];
                    });

             /* Governorate map with ID adm1_code */
                    d3.json("data/admin1.geojson", function (governJSON){
                        map2_chart.width(400).height(300)
                            .dimension(cf.gcode)
                            .group(gcode)
                            .colors(['#AAAAAA', '#CB181D'])
                            .colorDomain([0, 1])
                            .on("filtered", getFiltersValues)
                            .colorAccessor(function (d) {
                                if(d>0){
                                    return 1;
                                } else {
                                    return 0;
                                }
                            })
                            .overlayGeoJson(governJSON.features, "Governorates", function (d) {
                                return d.properties.adm1_code;
                            })
                            .projection(d3.geo.mercator().center([42,29.9]).scale(3500)) /* Center on Jordan */
                            .title(function (d) {
                                return "Geo-Filter: " + gcode2gov[d.key];
                            });

                            $('#loading').hide();
                            $('#dashboard').show();
                            dc.renderAll();

                            /* Customised infobox */
                            d3.selectAll("g.row").call(rowTip);
                            d3.selectAll("g.row").on('mouseover', rowTip.show)
                                .on('mouseout', rowTip.hide);

                            d3.selectAll(".pie-slice").call(pieTip);
                            d3.selectAll(".pie-slice").on('mouseover', pieTip.show)
                                .on('mouseout', pieTip.hide);
                    });
                });
        });
    </script>
    <script src="js/bootstrap.min.js"></script>
    <!-- Piwik-->
    <script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://data.unhcr.org/piwik/" : "http://data.unhcr.org/piwik/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 21);
    piwikTracker.trackPageView();
    piwikTracker.enableLinkTracking();
    } catch( err ) {}
    </script><noscript><p><img src="http://data.unhcr.org/piwik/piwik.php?idsite=21" style="border:0" alt="" /></p></noscript>
    <!-- End Piwik Tracking Code -->
  </body>
</html>
